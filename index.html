<html><title>SHUTTLEDECK</title><link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" sizes="64x64"/><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"><style>canvas{width:100%;height:100%;}body{margin:0;background:#000;}</style><canvas><script>(()=>{var H,$,e=document.getElementsByTagName("canvas")[0],i=e.getContext("2d");function t(){e.width=+window.innerWidth,e.height=+window.innerHeight,H=e.width,$=e.height}i.imageSmoothingEnabled=!0,i.lineCap="round",i.lineJoin="round",t(),window.addEventListener("resize",t);var c=[];function p(e){c.push(e)}var j=b=new function(){var i={};return{clear:()=>i={},on:(e,t)=>(i[e]||(i[e]=[])).push(t),off:(e,t)=>i[e]=(i[e]||[]).filter(e=>e!=t),emit:(e,t)=>(i[e]||[]).forEach(e=>e(t))}};function l(t,n){var a=0;this.update=e=>{1<(a+=e/t)&&n&&(this.destroyed=!0,j.emit("txn-done"))},this.render=e=>{var t=H,i=$,l=0,l=n?Math.max(1-a*a,0):Math.pow(1.3*Math.max(a-.3,0),2);e.save(),e.fillStyle="#443",e.translate(0,.6*-i*l),e.fillRect(0,0,t,i/2),e.strokeStyle="#b94",e.fillStyle="#b94",e.lineWidth=.03*t,e.fillRect(0,i/2,t,.05*i),e.strokeRect(.25*t,.2*i,.5*t,.2*i),e.textAlign="center",e.textBaseline="middle",e.font=.06*t+"px monospace",e.fillText("SHUTTLEDECK",.5*t,.3*i),e.restore(),e.save(),e.fillStyle="#443",e.translate(0,.6*i*l),e.fillRect(0,i/2,t,i/2),e.fillStyle="#b94",e.fillRect(0,.55*i,t,.05*-i),e.restore()}}function K(t,i,l,n,a){var o=H,r=$,s=Math.sqrt(o*r)/10;t.beginPath(),t.strokeStyle="#aaa",t.fillStyle="#ddd",t.lineWidth=.5;for(let e=0;e<s;e++){var h=1+5*(.5*Math.sin(e*e*1217+e*e*e*983)+.5),f=(1234918*e*e+e*e*e*e*2291722+i*h)%(o+100)-50,c=(3000182*e*e*e*e+e*e*e*e*e*500291+l*h)%(r+100)-50;t.moveTo(f,c),t.lineTo(f+n*h,c+a*h),t.fillRect(f-1,c-1,2,2)}t.stroke()}function G(t,e,i,l,n,a,o){t.save(),a&&(l*=1.04);var r=`rgba(${n.color[0]},${n.color[1]},${n.color[2]},${o})`,s=l/2,h=1.5*s,f=(t.translate(e,i),t.fillStyle=a?`rgb(80,80,80,${.7*o})`:`rgb(50,50,50,${.7*o})`,t.fillRect(-s,-h,2*s,2*h),t.save(),t.beginPath(),t.rect(-s,-h,2*s,2*h),t.clip(),t.fillStyle=`rgba(220,230,250,${.3*o})`,t.rotate(-.3),t.translate(l/2,Date.now()%2e3/1e3*(5*l)-1.2*l),t.fillRect(2*-l,0,4*l,.2*l),t.fillRect(2*-l,.2*-l,4*l,.05*l),t.restore(),t.beginPath(),t.lineWidth=l/20,t.lineJoin="round",t.strokeStyle=r,t.moveTo(-s,-h),t.lineTo(s,-h),t.lineTo(s,h),t.lineTo(-s,h),t.closePath(),t.stroke(),t.save(),t.translate(0,.15*-l),n.glyph(t,l),t.translate(0,.52*-l),t.fillStyle=`rgba(255,255,51,${o})`,.12*l);for(let e=0;e<n.cost;e++)t.fillRect((e-(n.cost-1)/2)*f*1.1-.45*f,0,.9*f,.9*f);t.restore(),t.fillStyle=r,t.textBaseline="middle",t.font=l/6+"px monospace",t.textAlign="center";var c=n.title;for(let e=0;e<c.length;e++)t.fillText(c[e],0,.65*h+(e-(c.length-1)/2)*h*.2);t.restore()}function O(e,t,i,l,n){e.save(),e.translate(t,i),e.fillStyle="#f3f",e.rotate(l),e.fillRect(-n,-n,2*n,2*n),n*=.6,e.fillStyle="#fbf",e.fillRect(-n,-n,2*n,2*n),e.restore()}function q(e,t,i,l,n){e.fillStyle="#333",e.beginPath(),e.arc(t,i,l,0,6.28),e.fill(),n&&(e.fillStyle="#3ff",e.beginPath(),e.arc(t,i,.65*l,0,6.28),e.fill())}function N(e,t,i,l,n){e.fillStyle="#333",e.fillRect(t,i,.8*l,l),n&&(e.fillStyle="#ff3",e.fillRect(t+.175*l,i+.175*l,.45*l,.65*l))}function U(e,t,i,l){e.save(),e.strokeStyle="#ccc",e.fillStyle="#222",e.lineWidth=.1*l;var n=.5*l;e.translate(t-n,i+n),e.fillRect(-l,1.5*-l,2*l,3*l),e.strokeRect(-l,1.5*-l,2*l,3*l),e.translate(n,-n),e.fillRect(-l,1.5*-l,2*l,3*l),e.strokeRect(-l,1.5*-l,2*l,3*l),e.translate(n,-n),e.fillRect(-l,1.5*-l,2*l,3*l),e.strokeRect(-l,1.5*-l,2*l,3*l),e.restore()}function y(e){var t=H,i=$,t=Math.min(.075*i,.1*t);e.save(),e.translate(1.2*t,i+Math.sin(.003*Date.now())*t*.1),e.fillStyle="#bbb",e.beginPath(),e.arc(.1*-t,.1*t,1.4*t,0,6.29),e.fill(),e.fillStyle="#eee",e.beginPath(),e.arc(0,1.9*-t,t,0,6.29),e.fill(),e.fillStyle="#3af",e.fillRect(.1*-t,2.1*-t,t,.4*t),e.restore()}function D(e,t="#3b5"){var i=H,l=$,n=Math.min(.075*l,.1*i);e.save(),e.translate(i-1.2*n,l+Math.sin(.0021*Date.now()+3)*n*.1),e.fillStyle=t,e.fillRect(.5*-n,1.5*-n,1.4*n,2*n),e.fillStyle="#666",e.fillRect(.2*-n,1.5*-n,.1*n,2*n),e.fillRect(.35*-n,.8*-n,.1*n,.1*n),e.fillRect(.35*-n,.6*-n,.1*n,.1*n),e.fillStyle="#fdb",e.beginPath(),e.arc(0,1.8*-n,n,0,6.29),e.fill(),e.fillStyle="#333",e.fillRect(-n,1.95*-n,1.6*n,.1*n),e.fillStyle=t,e.beginPath(),e.arc(.8*-n,1.8*-n,.3*n,0,6.29),e.fill(),e.beginPath(),e.arc(.1*-n,1.8*-n,.3*n,0,6.29),e.fill(),e.restore()}function E(e){var t=H,i=$,l=Math.min(.075*i,.1*t);e.save(),e.translate(t-1.2*l,i+Math.sin(.0021*Date.now()+3)*l*.1),e.fillStyle="#d72",e.beginPath(),e.ellipse(.1*l,.1*l,+l,1.4*l,0,0,6.29),e.fill(),e.fillStyle="#f94",e.beginPath(),e.arc(0,1.9*-l,l,0,6.29),e.fill(),e.fillRect(.8*-l,2.3*-l,.4*l,-l),e.fillRect(.4*l,2.4*-l,.4*l,-l),e.fillStyle="#fff",e.beginPath(),e.ellipse(.3*-l,2*-l,.5*l,.3*l,0,0,6.29),e.fill(),e.fillStyle="#222",e.beginPath(),e.arc(.4*-l,2*-l,.2*l,0,6.29),e.fill(),e.restore()}function I(e){var t=H,i=$,l=Math.min(.075*i,.1*t);e.save(),e.translate(t-1.2*l,i+Math.sin(.0021*Date.now()+3)*l*.1),e.fillStyle="#77b",e.fillRect(1.1*-l,1.5*-l,2.2*l,2*l),e.fillStyle="#669",e.fillRect(.9*l,1.5*-l,.2*l,2*l),e.fillStyle="#338",e.fillRect(.5*l,2.7*-l,.3*l,1.25*l),e.fillRect(.2*-l,2.7*-l,.1*l,.8*-l),e.fillStyle="#55a",e.fillRect(.8*-l,2.7*-l,1.3*l,1.25*l),e.fillStyle="#ff4",e.fillRect(.25*-l,3.4*-l,.2*l,.2*-l),e.fillRect(.7*-l,2.5*-l,.4*l,.2*l),e.fillRect(.2*-l,2.5*-l,.4*l,.2*l),e.restore()}function z(e){var t=H,i=$,l=Math.min(.075*i,.1*t);e.save(),e.translate(t-1.2*l,i+Math.sin(.0021*Date.now()+3)*l*.1),e.fillStyle="#b31",e.beginPath(),e.ellipse(.4*l,.1*l,.8*l,1.8*l,0,0,6.29),e.fill(),e.fillStyle="#d74",e.beginPath(),e.arc(0,1.6*-l,.6*l,0,6.29),e.fill(),e.strokeStyle="#d74",e.beginPath(),e.lineWidth=.1*l,e.moveTo(.4*-l,2*-l),e.lineTo(.7*-l,3*-l),e.moveTo(.1*-l,2*-l),e.lineTo(.1*-l,3.2*-l),e.moveTo(.2*l,2*-l),e.lineTo(.4*l,3*-l),e.stroke(),e.fillStyle="#eee",e.beginPath(),e.arc(.7*-l,3*-l,.2*l,0,6.29),e.fill(),e.beginPath(),e.arc(.1*-l,3.2*-l,.2*l,0,6.29),e.fill(),e.beginPath(),e.arc(.4*l,3*-l,.2*l,0,6.29),e.fill(),e.fillStyle="#611",e.beginPath(),e.arc(.78*-l,3*-l,.1*l,0,6.29),e.fill(),e.beginPath(),e.arc(.18*-l,3.2*-l,.1*l,0,6.29),e.fill(),e.beginPath(),e.arc(.32*l,3*-l,.1*l,0,6.29),e.fill(),e.restore()}function B(e){var t=H,i=$,l=Math.min(.075*i,.1*t);e.save(),e.translate(t-1.2*l,i+Math.sin(.0021*Date.now()+3)*l*.1),e.fillStyle="#343",e.beginPath(),e.arc(.2*l,0,.6*l,0,6.29),e.fill(),e.fillStyle="#353",e.beginPath(),e.arc(.5*l,.7*-l,.6*l,0,6.29),e.fill(),e.fillStyle="#363",e.beginPath(),e.arc(.4*l,1.4*-l,.6*l,0,6.29),e.fill(),e.fillStyle="#474",e.beginPath(),e.arc(0,1.9*-l,.8*l,0,6.29),e.fill(),e.fillStyle="#3f3",e.beginPath(),e.arc(.6*-l,2.1*-l,.07*l,0,6.29),e.fill(),e.beginPath(),e.arc(.4*-l,2.08*-l,.07*l,0,6.29),e.fill(),e.beginPath(),e.arc(.65*-l,1.9*-l,.07*l,0,6.29),e.fill(),e.beginPath(),e.arc(.45*-l,1.88*-l,.07*l,0,6.29),e.fill(),e.beginPath(),e.arc(.62*-l,1.7*-l,.07*l,0,6.29),e.fill(),e.beginPath(),e.arc(.42*-l,1.68*-l,.07*l,0,6.29),e.fill(),e.restore()}function Y(e){var t=H,i=$,l=Math.min(.075*i,.1*t);e.save(),e.translate(t-1.2*l,i+Math.sin(.0021*Date.now()+3)*l*.1-.5*l),e.fillStyle="#46c",e.beginPath(),e.arc(.2*-l,1.5*-l,.4*l,0,6.29),e.fill(),e.beginPath(),e.arc(.2*l,1.4*-l,.3*l,0,6.29),e.fill(),e.fillStyle="rgba(100,100,255,0.3)",e.beginPath(),e.arc(0,.95*-l,1.1*l,-3.14,0),e.fill(),e.fillStyle="#db3",e.fillRect(1.2*-l,-l,2.4*l,.3*l),e.fillRect(.6*-l,.55*-l,1.2*l,.2*l),e.fillRect(.3*-l,.2*-l,.6*l,.1*l),e.restore()}var A=(t,i,l)=>{var n,a,o="",r=[];for(let e=0;e<i.length;e++)o+=i[e],t.measureText(o).width>l&&(n=o.lastIndexOf(" "),a=o.substring(0,n),r.push(a.trim()),o=o.substring(n));return 0<o.trim().length&&r.push(o.trim()),r},X=(e,t,i,l,n)=>{var a=L[t];return a&&a.w==i&&a.h==l?a.lines:(a=A(e,t,n),L[t]={w:i,h:l,lines:a},a)},L={};function m(t,e,i){var l=H,n=$,a=Math.min(.075*n,.1*l),o=Math.max(.09*l,.08*n),r=(t.save(),t.fillStyle="#236",t.strokeStyle="#3af",t.lineWidth=.1*a,t.beginPath(),t.moveTo(2.8*a,.75*n),t.lineTo(l-2.8*a,.75*n),t.lineTo(l-2.8*a,n-1.8*a),t.lineTo(l-2.5*a,n-1.6*a),t.lineTo(l-2.8*a,n-1.4*a),t.lineTo(l-2.8*a,n-.2*a),t.lineTo(2.8*a,n-.2*a),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#ff3",t.textAlign="left",t.font=.3*o+"px monospace",t.fillText(e,3*a,.75*n+.25*o),t.fillStyle="#fff",t.textAlign="left",t.font=.25*o+"px monospace",X(t,i,l,n,l-6*a));for(let e=0;e<r.length;e++)t.fillText(r[e],3*a,.75*n+o*(2.1+e)*.3);t.restore()}var n=function(a="Liftoff"){var l=({x:e,y:t})=>{var i=.18*H;.97*H-2*i<e&&e<.97*H&&0<t&&t<.02*H+.8*i&&(j.emit("start"),j.off("tap",l))};j.on("tap",l),this.render=e=>{var t=H,i=.18*t,l=(e.save(),e.translate(.97*t-i,.02*t+.4*i),Date.now()%500/500),n=.4*(1-(1-l)*(1-l))+.8;e.scale(n,1.1*n),e.strokeStyle="#0a0",e.lineWidth=.1*i*(1-l),e.strokeRect(-i,.4*-i,2*i,.8*i),e.restore(),e.fillStyle="#0a0",e.fillRect(.97*t,.02*t,2*-i,.8*i),e.fillStyle="#fff",e.font=.35*i+"px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(a,.97*t-i,.02*t+.4*i)}};var a=new function(){var r,e,t,i,l,n,a,o,s,h,f,c,d,g,p,y,m=null,u=e=>Math.min(Math.max(Math.sin(e),-1),1),v=e=>(e%6.28-3.14)/6.28,S=e=>Math.min(Math.max(1e3*Math.sin(e),-1),1),x=(e,t,i)=>e<44100*t||44100*i<e?0:1-(e/44100-t)/(i-t),b=(e,t,i,l)=>.01*S(e/(80/Math.pow(2,t/12)))*x(e,i,i+l),T=(e,t)=>.02*Math.random()*x(e,t,t+.06),M=(e,t,i=!0)=>{for(var e=m.createBuffer(1,r*e,r),l=e.getChannelData(0),n=e.length,a=0;a<n;a++){var o=i?1-a/n:1;l[a]=t(44100*a/r)*o}return e},P=(this.init=()=>{m=new(window.AudioContext||window.webkitAudioContext),r=m.sampleRate,e=M(.6,e=>.05*S(e/250)*(u(e/300)+0)),t=M(1,e=>.05*S(e/250)*(u(e/300)+0)+.1*Math.random()*x(e,0,1)),i=M(.7,e=>.07*(v(e/19)*x(e,0,.15)+v(e/11)*x(e,.1,.7))),l=M(.15,e=>.04*u(e/(15-e/2e3))),n=M(.8,e=>.1*Math.random()*x(e,0,.8)*(S(e/200)+1)),a=M(.4,e=>.04*(1+Math.random()/3)*x(e,0,.4)*u(e/50)),o=M(.7,e=>.04*Math.random()*x(e,0,.7)*(S(e/100)+1)),s=M(1.5,e=>.08*(u(e/(30-e/400))*x(e,0,.15)*3+v(e/60)*(S(e/400)+1)/2*x(e,.1,1.5))),h=M(1,e=>.04*u(e/50)*(S(e/800+1)+1)),f=M(.7,e=>.1*(v(e/30)*x(e,0,.1)+v(e/50)*x(e,.1,.2)+v(e/40)*x(e,.2,.3)+v(e/20)*x(e,.3,.4)+v(e/10)*x(e,.4,.5))),c=M(.7,t=>{var i=0;for(let e=0;e<10;e++)i+=u(t/(10+e*e/20))*x(t,e/10,(e+1)/10);return.05*i}),d=M(1.5,t=>{var i=0;for(let e=0;e<13;e++)i=(i+=S(t/(10-e*e/15))*x(t,e/15,(e+1)/15))+S(t/(40-e*e/3))*x(t,e/15+.03,(e+1)/15);return.05*i}),g=M(.6,e=>.04*u(e/(50-e/2e3))*(S(e/700+1)+1)),p=M(.2*48,t=>{var i=0;for(let e=0;e<48;e+=8)i+=T(t,.2*(e+0))+T(t,.2*(e+1))+3*T(t,.2*(e+2))+T(t,.2*(e+3))+T(t,.2*(e+4))+3*T(t,.2*(e+6));return i+=b(t,12,1.6,.2)+b(t,7,2.2,.2)+b(t,10,.2*14,.2*1.5)+b(t,9,3.2,.2*1.5)+b(t,3,3.6,.2*1.5)+b(t,6,6.4,.2)+b(t,3,7,.2)+b(t,5,.2*38,.2*1.5)+b(t,3,8,.2*1.5)+b(t,0,8.4,.2*1.5)},!1),y=M(3,e=>.01*(v(e/300)*S(e/130)+1),!1)},e=>{var t=m.createBufferSource();t.buffer=e,t.connect(m.destination),t.start()}),w=(this.setup=()=>{null==m&&this.init(),j.on("txn",()=>{P(e)}),j.on("txn-done",()=>{P(t)}),j.on("buy",()=>{P(i)}),j.on("mineral",()=>{P(l)}),j.on("mine",()=>{P(l)}),j.on("hit",()=>{P(n)}),j.on("boom",()=>{P(n)}),j.on("lane",()=>{P(a)}),j.on("hop",()=>{P(f)}),j.on("dash",()=>{P(c)}),j.on("hyper",()=>{P(d)}),j.on("heal",()=>{P(g)}),j.on("projectile",e=>{1!=e&&4!=e&&5!=e||P(o),2==e&&P(s),3==e&&P(h)})},null);this.music=()=>{null==m&&this.init(),(w=m.createBufferSource()).buffer=p,w.loop=!0,w.connect(m.destination),w.start()},this.bgRocket=()=>{null==m&&this.init(),(w=m.createBufferSource()).buffer=y,w.loop=!0,w.connect(m.destination),w.start()},this.stopMusic=()=>{try{null!=w&&w.stop()}catch(e){}}};function J(i,l){var n=.4*Math.random()+.2,a=(Math.random()+1)*H*.02,t=(Math.random()-.5)*$*.08*a;this.update=e=>{(n-=e)<0&&(this.destroyed=!1),a+=a*n*e,l+=t*e,t-=t*e*2,i-=(Math.random()-.5)*a*e*5},this.render=e=>{var t=n;e.fillStyle=`rgba(255,255,255,${t})`,e.beginPath(),e.arc(i,l,Math.max(a,1),0,6.29),e.fill()}}var r=function(e,t,i,l="#fff",n="1",a="left"){this.str=e,this.x=t,this.y=i,this.color=l,this.size=n,this.render=e=>{var t=.08*H;e.textAlign=a,e.textBaseline="middle",e.fillStyle=this.color,e.font=this.size*t+"px monospace",e.fillText(this.str,this.x(),this.y())}};function F(){this.render=e=>K(e,.03*-Date.now(),0,3,0),p(new r("SHUTTLEDECK",()=>H/2,()=>.4*$,"#fff",1,"center"));var t,i,l,n,a,o=new r("[ Press to start ]",()=>H/2,()=>.6*$,"#777",.5,"center"),e=(o.ecs=[(t=e=>{o.size=e},i=.45,l=.55,n=1,a=0,e=>{a+=e,t((Math.sin(a/n*6.3)+1)/2*(l-i)+i)})],p(o),p(new r("by Ariel Wexler",()=>H/2,()=>.8*$,"#f3f",.35,"center")),()=>{j.emit("transition-scene",1),j.off("tap",e)});j.on("tap",e)}var o,s,h,f,d,g,u=[{color:[255,51,51],title:["Rho","Channel"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,-t/6,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,t/10,t/3,0),e.strokeRect(-t/6,t/4,t/3,0),e.restore()},use:()=>{j.emit("lane",0)}},{color:[51,255,51],title:["Gamma","Sector"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,-t/4,t/3,0),e.strokeRect(-t/6,t/4,t/3,0),e.restore()},use:()=>{j.emit("lane",1)}},{color:[51,51,255],title:["Beta","Stream"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,t/6,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,-t/10,t/3,0),e.strokeRect(-t/6,-t/4,t/3,0),e.restore()},use:()=>{j.emit("lane",2)}},{color:[255,160,30],title:["Kepler","Missile"],cost:2,price:10,glyph:function(e,t,i=.05){e.save(),e.translate(t/20,0),e.rotate(.6),e.lineWidth=t*i,e.beginPath(),e.moveTo(-t/18,-t/6),e.lineTo(0,-t/4),e.lineTo(t/18,-t/6),e.lineTo(t/18,t/4),e.lineTo(-t/18,t/4),e.closePath(),e.moveTo(-t/8,t/4),e.lineTo(-t/6,t/4),e.lineTo(-t/8,t/10),e.closePath(),e.moveTo(t/8,t/4),e.lineTo(t/6,t/4),e.lineTo(t/8,t/10),e.closePath(),e.stroke(),e.restore()},use:()=>{j.emit("projectile",1)}},{color:[255,160,30],title:["Sigma","Cannon"],cost:3,price:15,glyph:function(e,t){e.save(),e.translate(t/12,t/15),e.rotate(.6),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.moveTo(-t/4,-t/4),e.lineTo(-t/14,-t/4),e.lineTo(-t/14,-t/10),e.lineTo(t/10,-t/10),e.lineTo(t/10,t/4),e.lineTo(-t/4,t/4),e.closePath(),e.moveTo(-t/6,0),e.lineTo(0,0),e.lineTo(-t/12,t/12),e.lineTo(0,t/6),e.lineTo(-t/6,t/6),e.stroke(),e.restore()},use:()=>{j.emit("projectile",2)}},{color:[255,160,30],title:["Pulse","Breaker"],cost:3,price:15,glyph:function(e,t){e.save(),e.translate(-t/30,0),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,0,t/16,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/5,-1,1),e.stroke(),e.beginPath(),e.arc(0,0,t/3,-.8,.8),e.stroke(),e.rotate(.5),e.strokeRect(-t/8,-t/30,-t/8,t/15),e.rotate(-1),e.strokeRect(-t/8,-t/30,-t/8,t/15),e.restore()},use:()=>{j.emit("projectile",3)}},{color:[255,160,30],title:["Crazy","Rockets"],cost:2,price:10,glyph:function(t,i){t.save(),t.lineWidth=.05*i,t.lineCap="round";for(let e=0;e<2;e++)t.beginPath(),t.moveTo(-i/4,i/8),t.lineTo(-i/6,-i/8),t.lineTo(i/14,i/20),t.lineTo(i/8,-i/6),t.stroke(),t.beginPath(),t.moveTo(i/8+i/12,-i/6),t.lineTo(i/8-i/12,-i/6),t.lineTo(i/8,-i/6-i/8),t.closePath(),t.stroke(),t.translate(i/16,i/5),t.rotate(.2);t.restore()},use:()=>{j.emit("projectile",4)}},{color:[255,160,30],title:["Tactical","Nuke"],cost:4,price:20,glyph:function(t,i){t.save(),t.lineWidth=.05*i,t.lineCap="round",t.beginPath(),t.arc(0,0,i/3,0,6.29),t.stroke(),t.beginPath(),t.arc(0,0,i/20,0,6.29),t.stroke(),t.rotate(.5);for(let e=0;e<3;e++)t.beginPath(),t.arc(0,0,i/4,-.4,.4,!1),t.arc(0,0,i/8,.4,-.4,!0),t.closePath(),t.stroke(),t.rotate(2.1);t.restore()},use:()=>{j.emit("projectile",5)}},{color:[255,70,255],title:["Quantum","Hopper"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,t/5,t/14,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/14,0,6.29),e.stroke(),e.beginPath(),e.arc(0,-t/5,t/14,0,6.29),e.stroke(),e.restore()},use:()=>{j.emit("hop",2)}},{color:[255,70,255],title:["Shadow","Dash"],cost:2,price:10,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.translate(-t/20,t/10),e.rotate(.6),e.beginPath(),e.arc(0,0,t/10,0,6.29),e.stroke(),e.beginPath(),e.moveTo(0,-t/6),e.lineTo(0,-t/3),e.moveTo(0,t/6),e.lineTo(0,t/4),e.stroke(),e.beginPath(),e.moveTo(-t/12,-t/3),e.lineTo(t/12,-t/3),e.lineTo(0,-t/2),e.closePath(),e.stroke(),e.restore()},use:()=>{j.emit("dash")}},{color:[255,70,255],title:["Shield","Charger"],cost:3,price:15,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,0,t/4,0,6.29),e.stroke(),e.beginPath(),e.moveTo(-t/7,0),e.lineTo(t/7,0),e.moveTo(0,-t/7),e.lineTo(0,t/7),e.stroke(),e.restore()},use:()=>{j.emit("heal")}},{color:[255,70,255],title:["Mineral","Siphon"],cost:3,price:15,glyph:function(t,i){t.save(),t.lineWidth=.05*i,t.lineCap="round";for(let e=0;e<3;e++)t.save(),t.translate((1-(e-1)*(e-1))*i/5,(e-1)*i/5),t.beginPath(),t.moveTo(-i/12,0),t.lineTo(0,-i/10),t.lineTo(i/12,0),t.lineTo(0,i/10),t.closePath(),t.stroke(),t.restore();t.beginPath(),t.moveTo(0,0),t.lineTo(-i/3,0),t.moveTo(-i/8,i/10),t.lineTo(-i/3,0),t.moveTo(-i/8,-i/10),t.lineTo(-i/3,0),t.stroke(),t.restore()},use:()=>{j.emit("mine")}},{color:[255,70,255],title:["Hyper","Drive"],cost:4,price:20,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.moveTo(-t/6,-t/4),e.lineTo(t/6,-t/4),e.lineTo(-t/6,t/4),e.lineTo(t/6,t/4),e.closePath(),e.stroke(),e.restore()},use:()=>{j.emit("hyper")}},{color:[0,255,255],title:["Defense","Blessing"],cost:0,price:25,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/3,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/7,0,6.29),e.stroke(),e.restore()},use:()=>{j.emit("persist-max-shield")}},{color:[255,255,0],title:["Strength","Blessing"],cost:0,price:25,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.translate(0,-t/10),e.strokeRect(-t/4,-t/6,t/2,.6*t),e.strokeRect(-t/10,-t/4,t/5,-t/8),e.translate(0,t/7),e.beginPath(),e.moveTo(-t/10,-t/6),e.lineTo(t/10,-t/6),e.lineTo(-t/20,0),e.lineTo(t/20,0),e.lineTo(0,t/6),e.stroke(),e.restore()},use:()=>{j.emit("persist-max-energy")}},{color:[200,200,200],title:["Vision","Blessing"],cost:0,price:25,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.strokeRect(.25*-t,0,.2*t,.3*t),e.strokeRect(.05*t,0,.2*t,.3*t),e.strokeRect(.1*-t,.4*-t,.2*t,.3*t),e.restore()},use:()=>{j.emit("persist-max-hand")}}],Z=(s=o=0,f=5,d=h=3,g=[],(P={reset:()=>{f=5,d=h=3,g=[u[s=o=0],u[0],u[0],u[1],u[1],u[1],u[2],u[2],u[2]]},getMinerals:()=>o,addMineral:e=>o+=e,getLevel:()=>s,setLevel:e=>s=e,getHandSize:()=>h,setHandSize:e=>h=e,getMaxEnergy:()=>f,setMaxEnergy:e=>f=e,getMaxShield:()=>d,setMaxShield:e=>d=e,getDeck:()=>g,addToDeck:e=>g.push(e)}).reset(),P);function Q(){p(new r("Professor Zorn's Lab",()=>.03*H,()=>.05*H,"#fff",.5,"left")),p(new n),j.on("start",()=>{Z.reset(),j.emit("transition-scene",2)}),this.render=e=>{var t,i,l,n,a=.3*$;y(e),D(e),m(e,"Professor Zorn","Hey there Courier, I need your help getting this Xenotransponder to Korva-6. It's only a few planets away."),i=.5*H,l=.4*$,n=a,(t=e).save(),t.translate(i,l),n/=2,t.fillStyle="#333",t.strokeStyle="#666",t.lineWidth=.1*n,t.beginPath(),t.arc(0,0,n,0,6.29),t.fill(),t.stroke(),t.restore(),i=.5*H,l=.4*$,n=a,(t=e).save(),t.translate(i,l),n/=2,t.fillStyle="#ccd",t.fillRect(.07*n,.7*-n,.15*n,.7*n),t.beginPath(),t.arc(.1*n,.54*-n,.24*n,0,6.29),t.fill(),t.fillStyle="#b94",t.fillRect(.6*-n,.1*-n,1.2*n,.7*n),t.fillRect(.3*n,.3*-n,.4*n,.5*n),t.fillStyle="#aaa",t.textAlign="center",t.textBaseline="bottom",t.font=.2*n+"px monospace",t.fillText("Xenotransponder",0,1.4*n),t.restore()}}var V=function(t,i,l,n){var a=0;this.update=e=>{i-=500*(.5-a)*e,n+=3*n*(.5-a)*e,.5<(a+=1.2*e)&&(this.destroyed=!0)},this.render=e=>{G(e,t,i,n,l,!1,2*(.5-a))}};var _=function(l,n,a,o,r,t){var s=-.5;this.update=e=>{1<(s+=3*e)&&(this.destroyed=!0,j.emit("place",{slot:t,card:o}))},this.render=e=>{var t=.15,i=(l.hasEnergy(o)&&(t=1),Math.min(Math.max(s,0),1));G(e,n*i*i+H/2*(1-i*i),a*i*i+$*(1-i*i),r*i,o,!1,i*t)}};var ee=function(l,t,i){var n=100*Math.random();this.x=0,this.y=0,this.obstacle=!0,this.update=e=>{n+=.1*e,this.x=l.laneX(t),this.y=l.laneY(i),l.getTick()>t+6&&(this.destroyed=!0),l.closeToShip(l.laneX(t),l.laneY(i),2)&&(this.destroyed=!0,j.emit("hit",1))},this.render=t=>{t.save(),t.translate(this.x,this.y);var i=+l.laneScale();t.fillStyle="#963";for(let e=0;e<8;e++)t.beginPath(),t.arc((e+.7)*i*.3+Math.sin(3*n+e*e*4)*i*.6,Math.sin(5*n+e*e*4)*i*.7,.6*i/(+e+1),0,6.29),t.fill();t.beginPath(),t.arc(0,0,i,0,6.29),t.fill(),t.restore()}};var te=function(a,o,r,e){var s=100*Math.random(),h=(this.x=0,this.y=0,!1),f=0,c=1,d=(.6<Math.random()&&(c=3,.6<Math.random()&&(c=7)),()=>{h=!0,j.emit("poof",{x:this.x,y:this.y,color:[255,130,255],size:.6,t:.3}),j.off("mine",d)});j.on("mine",d),this.update=e=>{var t,i,l,n;s+=+e,h?(t=a.getShipX()-this.x,i=a.getShipY()-this.y,l=Math.sqrt(t*t+i*i),n=H*f,f+=e,this.x+=t/l*n*e,this.y+=i/l*n*e):(this.x=a.laneX(o),this.y=a.laneY(r)),a.getTick()>o+6&&!h&&(this.destroyed=!0,j.off("mine",d)),a.closeToShip(this.x,this.y,1.4)&&(this.destroyed=!0,j.off("mine",d),j.emit("mineral",c))},this.render=t=>{var i=a.laneScale();if(1==c)O(t,this.x,this.y,s,.4*i);else if(3==c)O(t,this.x-i/3,this.y,s,.3*i),O(t,this.x+i/3,this.y-i/2,s,.3*i),O(t,this.x+i/3,this.y+i/2,s,.3*i);else if(7==c){for(let e=0;e<6;e++)O(t,this.x+Math.sin(1.04*e)*i*.8,this.y+Math.cos(1.04*e)*i*.8,s,.25*i);O(t,this.x,this.y,s,.3*i)}}};var v=function(s,e,t,i,h){var f=0,l=(this.x=e,this.y=t,[]);this.update=e=>{var t,i,l,n;if(f+=+e,5==h){if(this.x+=e*H*(1-f/.35),.35<f){c.forEach(e=>{e.obstacle&&(e.destroyed=!0,j.emit("poof",{x:e.x,y:e.y,color:[255,50,50],size:1,t:.5}))});var a=H,o=$,r=Math.sqrt(a*o)/20;for(let e=0;e<r;e++)j.emit("poof",{x:Math.random()*a,y:Math.random()*o,color:[255,244,50],size:+Math.random()+1,t:.4*Math.random()+.4});j.emit("boom"),this.destroyed=!0}}else 2!=h?(4!=h?this.x+=e*H/2:(t=.4*Math.sin(Date.now()/30),this.homing&&!this.homing.destroyed&&(t+=Math.atan2(this.homing.y-this.y,this.homing.x-this.x)),this.y+=e*H*.8*Math.sin(t),this.x+=e*H*.8*Math.cos(t)),4<f&&(this.destroyed=!0),s.collideTargets(this.x,this.y,1.5)&&(this.destroyed=!0,j.emit("boom"),1==h&&j.emit("poof",{x:this.x,y:this.y,color:[255,200,100],size:1,t:.5}),3==h&&j.emit("poof",{x:this.x,y:this.y,color:[100,255,100],size:1,t:.5}),4==h&&j.emit("poof",{x:this.x,y:this.y,color:[255,200,140],size:.6,t:.5}))):(i=s.laneScale(),l=s.getShipY(),n=s.getShipX(),c.forEach(e=>{var t;e.obstacle&&(t=l-e.y)*t<i*i&&e.x>n&&!e.destroyed&&(e.destroyed=!0,j.emit("poof",{x:e.x,y:l,color:[50,130,255],size:.7,t:.5}))}),1<f&&(this.destroyed=!0))},this.render=t=>{t.save();var e=s.laneScale();if(1==h&&(t.fillStyle="#fff",t.translate(this.x,this.y),t.fillRect(.2*-e,.2*-e,1.2*e,.4*e),t.fillRect(.4*-e,.35*-e,.4*e,.2*e),t.fillRect(.4*-e,.15*e,.4*e,.2*e),t.fillStyle="#fa3",0<Math.sin(Date.now()/14)&&t.fillRect(.3*-e,.05*-e,.8*-e,.1*e)),2==h&&(t.translate(s.getShipX(),s.getShipY()),t.fillStyle="#338",t.fillRect(.8*e,.3*-e,.6*e,.6*e),t.fillRect(.9*e,.2*-e,H,.4*e),t.fillStyle="#3af",0<Math.sin(Date.now()/14)&&(t.fillRect(e,.1*-e,H,.2*e),t.fillRect(.9*e,.2*-e,.4*e,.4*e))),3==h&&(t.fillStyle="#383",t.translate(this.x,this.y),t.beginPath(),t.arc(0,0,.6*e,0,6.29),t.fill(),0<Math.sin(Date.now()/14)&&(t.fillStyle="#8f8",t.beginPath(),t.arc(0,0,.4*e,0,6.29),t.fill())),4==h){t.fillStyle="#fa4",t.beginPath(),t.arc(this.x,this.y,.3*e,0,6.29),t.fill(),l.unshift({x:this.x,y:this.y}),14<l.length&&l.pop(),t.lineWidth=.1*e,t.strokeStyle="#fa4",t.beginPath(),t.moveTo(this.x,this.y);for(let e=0;e<l.length;e++)t.lineTo(l[e].x,l[e].y);t.stroke()}5==h&&(t.fillStyle="#ff0",t.translate(this.x,this.y),t.beginPath(),t.arc(0,0,.4*e,0,6.29),t.fill(),t.fillStyle="#333",t.fillRect(.2*-e,.2*-e,.4*e,.4*e)),t.restore()}};var S=function(n,a,o,r,s,h){var f=0;this.update=e=>{h<(f+=+e)&&(this.destroyed=!0)},this.render=e=>{e.save();var t=n.laneScale(),i=(e.translate(a,o),e.beginPath(),1-f/h),l=.5+1.5*(1-Math.exp(-f/h*3));e.fillStyle=`rgba(${r[0]},${r[1]},${r[2]},${i})`,e.arc(0,0,s*t*l,0,6.29),e.fill(),e.restore()}};function ie(){var l=Z.getLevel(),a=e=>e.sort(()=>Math.random()-.5),n=e=>{var t=parseInt(Math.random()*M.length),i=M[t],t=(M.splice(t,1),H),l=$,n=x(t,l),t=b(e,n,t),l=T(l);p(new _(this,t,l,i,n,e)),0==M.length&&(a(M=o),o=[])},x=(e,t)=>Math.min(e*(.95/(1+r)),.185*t),b=(e,t,i)=>.5*i+(e-(r-1)/2)*t*1.17,T=e=>.735*e,M=Z.getDeck().map(e=>Object.assign({},e)),o=[],r=(a(M),Z.getHandSize()),P=[];for(let e=0;e<r;e++)n(e);var w=-1,s=1,k=1,R=0,C=0,W=0,D=Z.getMaxShield(),E=D,I=Z.getMaxEnergy(),z=I,B=0,Y=20+2*l,A=0,X=0,L=0;const h=e=>{var t=H,i=$,l=e.x,n=e.y,a=-1,o=P.length,r=Math.min(t*(.95/(1+o)),.185*i);for(let e=0;e<o;e++){var s=.5*t+(e-(o-1)/2)*r*1.17,h=.735*i;s-r/2<l&&l<s+r/2&&h-3*r/4<n&&n<h+3*r/4&&(a=e)}return a};j.on("tap",e=>{var t,i,l,e=h(e);0<=e&&null!=P[e]&&(cost=P[e].cost,z>=cost&&(z-=cost,P[e].use(),t=x(l=H,i=$),l=b(e,t,l),i=T(i),p(new V(l,i,P[e],t)),l=e,o.push(P[l]),P[l]=null,n(e)))}),j.on("move",e=>{w=h(e)}),j.on("lane",e=>{s=e}),j.on("hop",()=>{for(var t=s;t==s;)t=parseInt(3*Math.random());var i=this.getShipX(),l=this.laneScale();for(let e=0;e<3;e++){sz=.3;var n=[255,0,255];e==t&&(sz=1,n=[100,255,100]),p(new S(this,i+2*l,this.laneY(e),n,sz,.7))}s=t}),j.on("dash",()=>{C=.5,W=2}),j.on("hyper",()=>{C=.4,W=10}),j.on("persist-max-shield",()=>{Z.setMaxShield(Z.getMaxShield()+1)}),j.on("persist-max-energy",()=>{Z.setMaxEnergy(Z.getMaxEnergy()+1)}),j.on("persist-max-hand",()=>{Z.setHandSize(Z.getHandSize()+1)}),j.on("heal",()=>{E=Math.min(E+1,D),p(new S(this,this.getShipX(),this.getShipY(),[0,255,0],1,.5))}),j.on("poof",({x:e,y:t,color:i,size:l,t:n})=>{p(new S(this,e,t,i,l,n))}),j.on("projectile",e=>{var t,i,l,n;1!=e&&2!=e&&5!=e||p(new v(this,this.getShipX(),this.getShipY(),s,e)),3==e&&(p(new v(this,this.getShipX(),this.laneY(0),0,e)),p(new v(this,this.getShipX(),this.laneY(1),1,e)),p(new v(this,this.getShipX(),this.laneY(2),2,e))),4==e&&(t=this.laneScale(),i=new v(this,this.getShipX(),this.getShipY()-t/2,s,e),e=new v(this,this.getShipX(),this.getShipY()+t/2,s,e),l=c.filter(e=>e.obstacle&&e.x>3*t),n=parseInt(Math.random()*l.length),i.homing=l[n],l.splice(n,1),n=parseInt(Math.random()*l.length),e.homing=l[n],l.splice(n,1),p(i),p(e))}),j.on("place",({slot:e,card:t})=>{P[e]=t}),j.on("hit",e=>{(E-=e)<=0&&j.emit("transition-scene",4),j.emit("poof",{x:this.getShipX(),y:this.getShipY(),color:[255,255,255],size:1,t:.5})}),j.on("mineral",e=>{Z.addMineral(e)});var t=()=>{if(!(Y-7<A||4<W)){var t,i={};for(let e=0;e<.1+.15*l;e++)Math.random()>.7/(1+.04*l)&&(i[t=parseInt(3*Math.random())]||(i[t]=1,p(new ee(this,A,t))));.6<Math.random()&&(i[t=parseInt(3*Math.random())]||p(new te(this,A,t,i[t]=1)))}};this.hasEnergy=e=>z>=e.cost,this.laneY=e=>{return 0==e?.18*$:1==e?.34*$:.5*$},this.laneX=e=>{var t=H,i=50+t/40+this.laneScale();return i+(1-(A+X-e)/5)*(t+i)},this.laneScale=()=>{var e=H,t=$;return.3*Math.min(.16*t,e/8)},this.getTick=()=>A,this.getShipX=()=>{return 50+H/40+this.laneScale()},this.getShipY=()=>{return.18*$+k*$*.16},this.closeToShip=(e,t,i)=>{var l;return!(0<C)&&(l=this.laneScale(),(e=e-this.getShipX())*e+(e=t-this.getShipY())*e<l*l*i)},this.collideTargets=(i,l,n)=>{var a=this.laneScale(),o=!1;return c.forEach(e=>{var t;e.obstacle&&(t=i-e.x)*t+(t=l-e.y)*t<a*a*n&&(o=!0,e.destroyed=!0)}),o},this.update=e=>{1<(L+=e)&&(0<C?(C-=e,X+=e*W,L+=e*W*2):W=0,X+=2*e),1<X&&(X--,A++,t(),Y<A&&(13==l?j.emit("transition-scene",5):j.emit("transition-scene",3))),z<I?1<=(B+=.75*e)&&(--B,z++):B=0,R+=7*(.5*(s-k)-R)*e,k+=5*(s-k)*e},this.render=t=>{var i=H,l=$,n=i/40,e=.16*l,a=.1*l,o=a+e,r=o+e,s=.3*Math.min(e,i/8),h=(K(t,20*-L,0,3+W,0),.3*l),h=(t.fillStyle="#224",t.beginPath(),t.arc(-(A+X)/10*i,.34*l,h,0,6.28),t.fill(),t.beginPath(),t.arc(-(A+X-Y)/10*i+.4*i,.34*l,h,0,6.28),t.fill(),.02*l),h=(t.fillStyle="#446",t.fillRect(15+n,a/2,i-30-2*n,1),t.fillStyle="#446",t.beginPath(),t.arc(15+h,a/2,h,0,6.28),t.fill(),t.fillStyle="#446",t.beginPath(),t.arc(i-15-h,a/2,h,0,6.28),t.fill(),t.fillStyle="#fff",15+n+(A+X)/(Y+1)*(i-30-2*n));t.beginPath(),t.moveTo(h+n/3,a/2),t.lineTo(h-n/3,a/2-n/3),t.lineTo(h-n/3,a/2+n/3),t.closePath(),t.fill(),t.fillStyle="#f33",t.fillRect(15,a,n,e),t.fillStyle="#3f3",t.fillRect(15,o,n,e),t.fillStyle="#33f",t.fillRect(15,r,n,e),t.fillStyle="#f33",t.fillRect(i-15,a,-n,e),t.fillStyle="#3f3",t.fillRect(i-15,o,-n,e),t.fillStyle="#33f",t.fillRect(i-15,r,-n,e),t.fillStyle="rgba(100,100,100,0.4)",t.fillRect(15,a,i-30,1),t.fillRect(15,o,i-30,1),t.fillRect(15,r,i-30,1),t.fillRect(15,r+e,i-30,1),t.save(),t.translate(50+n+s,a+e/2+k*e),t.rotate(R);for(let e=5;0<=e;e--){e<1?t.fillStyle="#fd6":e<3?t.fillStyle="#fa1":t.fillStyle="#a41",t.beginPath();var f=.2*Math.sin(L*(e+1)*20)+.5;t.arc(-s-s*e*.1,Math.sin(40*-L+e)*e*s/30,s*f/(1.5+.3*e),0,6.29),t.fill()}t.translate(Math.sin(30*L)*s/60,Math.sin(35*L)*s/40),t.fillStyle="#fff",t.beginPath(),t.moveTo(s,0),t.lineTo(.65*-s,.8*-s),t.lineTo(.65*-s,.3*-s),t.lineTo(-s,.5*-s),t.lineTo(-s,.5*s),t.lineTo(.65*-s,.3*s),t.lineTo(.65*-s,.8*s),t.closePath(),0<C?(t.lineWidth=.1*s,t.strokeStyle="#fff",t.stroke()):t.fill(),t.fillRect(.4*-s,.4*s,s,.15*s),t.fillRect(.4*-s,.4*-s,s,.15*-s),t.restore();var h=Math.min(.025*l,.035*i),c=l-h,d=(t.textBaseline="bottom",t.font=h+"px monospace",t.textAlign="right",t.fillStyle="#ff3",t.fillText("Energy",i-n,c),t.textAlign="right",t.fillText(z,i-(n+6*h),c),t.textAlign="left",t.fillStyle="#888",t.font=.8*h+"px monospace",t.fillText("/ "+I,i-(n+5.7*h),c),1.2*h);for(let e=0;e<I;e++)N(t,i-(n+e*(.8*d+4)+d),c-2.4*d,d,e<z);t.fillStyle="#333";var o=(.8*d+4)*I,g=(t.fillRect(i-n,c-1.07*d,-o,2),t.fillStyle="#ff3",t.fillRect(i-n,c-1.07*d,-B*o,2),.6*h),p=l-h;t.textBaseline="bottom",t.font=h+"px monospace",t.textAlign="left",t.fillStyle="#3ff",t.fillText("Shield",n,p),t.textAlign="right",t.fillText(E,n+5.3*h,p),t.textAlign="left",t.fillStyle="#888",t.font=.8*h+"px monospace",t.fillText("/ "+D,n+5.6*h,p);for(let e=0;e<D;e++)q(t,n+e*(2.5*g+4)+g,p-4*g,g,e<E);var y,m,u,r=l-h,v=(t.textBaseline="bottom",t.font=h+"px monospace",t.textAlign="center",t.fillStyle="#f3f",t.fillText(Z.getMinerals(),.4*i,r),O(t,.4*i,r-2.1*h,.785,.5*h),t.fillStyle="#aaa",t.fillText(M.length,.6*i,r),U(t,.6*i,r-2.1*h,.4*h),P.length),S=x(i,l);for(let e=0;e<v;e++)null!=P[e]&&(y=b(e,S,i),m=T(l),u=1,z<P[e].cost&&(u=.15),G(t,y,m,S,P[e],w==e,u))}}function x(e){return e[parseInt(Math.random()*e.length)]}var T,M,P,w,k,R,C,le,W=["Tenadu","Nurosto Prime","Worlax","Mektrov Zero","Cytoxia","Broggendor","Voitec","Helion","Earth (Remnants)","Yonzi Mata","Streva Gateway","Lumatorr","Desela","Korva-6"];function ne(){var e=Z.getLevel(),s=(p(new r("Planet "+W[e],()=>.03*H,()=>.05*H,"#fff",.5,"left")),p(new n),j.on("start",()=>{Z.setLevel(Z.getLevel()+1),j.emit("transition-scene",2)}),onTapCard=({x:t,y:i})=>{var l=H,n=$,a=Z.getMinerals(),o=Math.min(.2*n,.25*l);for(let e=0;e<f.length;e++){var r=l/2+(e-(f.length-1)/2)*l*.3;null!=f[e]&&a>=f[e].price&&r-o/2<t&&t<r+o/2&&.4*n-3*o/4<i&&i<.4*n+3*o/4&&(p(new V(r,.4*n,f[e],o)),Z.addMineral(-f[e].price),j.emit("buy"),4==s?f[e].use():Z.addToDeck(f[e]),f[e]=null)}},[]),s=x(0==e?[0,2]:[0,1,2,3,4]),f=[],c="",d=E,g="";if(0==s){var c="Weapon Tech",d=E,g=x(["Stop staring human! Either buy something or leave.","Rockets! Laser beams! What are you looking for? I've got it all.","Hey hey, don't touch the merchandise! You might hurt yourself..."]),t=[u[3],u[4],u[5],u[6],u[7]],i=parseInt(2*Math.random())+2;for(let e=0;e<i;e++)f.push(t[parseInt(Math.random()*t.length)]);j.on("tap",onTapCard)}if(1==s){c="Ship Mechanic",d=I,g=x(["Beep Boop - May I assist you with upgrades for that spacefaring vessel?","Zip Zap - Your shield generator looks a bit flimsy. I can help with that.","Wrrrrr - Do you call that piece of scrap metal a ship?"]);t=[u[8],u[9],u[10],u[11],u[12]],i=parseInt(2*Math.random())+2;for(let e=0;e<i;e++)f.push(t[parseInt(Math.random()*t.length)]);j.on("tap",onTapCard)}if(2==s){c="Street Merchant",d=z,g=x(["Pssst. Yeah you. You look like you could use a pumpjack for that ship.","Only the best mechatronics here. Forged from the finest Worlax Steel.","Got this stuff from the Gateway District... You're not a cop right?"]);t=[u[3],u[4],u[8],u[9]],i=parseInt(2*Math.random())+2;for(let e=0;e<i;e++)f.push(t[parseInt(Math.random()*t.length)]);j.on("tap",onTapCard)}if(3==s){c="Cytox Smuggler",d=B,g=x(["Sssseems like you need ssssome black market tech. Letssss sssee what I've got...","Elzo Mineralsss are in short sssupply these daysss. My pricing hasss to ssslither up.","This lot isn't my normal sssset of ssssuplies, but itsss much sssafer than the cccytox trade."]);t=[u[5],u[6],u[10],u[11]],i=parseInt(2*Math.random())+2;for(let e=0;e<i;e++)f.push(t[parseInt(Math.random()*t.length)]);j.on("tap",onTapCard)}if(4==s){c="Neuro-Templar",d=Y,g=x(["I sense your journey has experienced rough patches. A blessing will surely aid you.","The Great Consciousness has a gift for you, but an exchange of minerals must be made.","Words from The Cortex will pave your road to enlightenment... for a small fee."]);t=[u[13],u[14],u[15]];for(let e=0;e<2;e++){var l=parseInt(Math.random()*t.length);f.push(t[l]),t.splice(l,1)}j.on("tap",onTapCard)}this.drawCost=(e,t,i,l,n,a)=>{e.fillStyle="#f3f",e.font=.25*n+"px monospace",e.textAlign="left",e.textBaseline="middle";var o=.061*n,r=(e.measureText(t).width+2*o)/2;e.fillText(t,i+3*o-r,l+n),O(e,i+o/2-r,l+n,.785,.08*n),a||(e.save(),e.fillStyle="rgba(255,0,0,0.7)",e.translate(i,l+n),e.rotate(.1),e.fillRect(.5*-n,-1,n,3),e.rotate(-.2),e.fillRect(.5*-n,-1,n,3),e.restore())},this.render=t=>{var i,l=H,n=$,a=Z.getMinerals(),e=Z.getHandSize(),o=Z.getMaxEnergy(),r=Z.getMaxShield(),s=(y(t),d(t),m(t,c,g),Math.min(.04*n,.04*l)),h=(t.textAlign="left",t.textBaseline="middle",t.font=s+"px monospace",O(t,s,.75*n,.785,.3*s),t.fillStyle="#f3f",t.fillText(a,1.7*s,.75*n),U(t,s,.75*n-s,.2*s),t.fillStyle="#999",t.fillText(e,1.7*s,.75*n-s),q(t,s,.75*n-2*s,.4*s,!0),t.fillStyle="#3ff",t.fillText(r,1.7*s,.75*n-2*s),N(t,s-.325*s,.75*n-3.45*s,.8*s,!0),t.fillStyle="#ff3",t.fillText(o,1.7*s,.75*n-3*s),Math.min(.2*n,.25*l));for(let e=0;e<f.length;e++)null!=f[e]&&(G(t,i=l/2+(e-(f.length-1)/2)*l*.3,.4*n,h,f[e],!1,1),this.drawCost(t,""+f[e].price,i,.4*n,h,a>=f[e].price))}}function ae(){var o=Z.getLevel(),e=(p(new r("SHUTTLEDECK",()=>H/2,()=>.2*$,"#fff",1,"center")),p(new r("Game Over",()=>H/2,()=>.35*$,"#f55",1,"center")),p(new r("Exploded approaching planet "+W[o],()=>H/2,()=>.6*$,"#f55",.4,"center")),p(new r("[ Press to retry ]",()=>H/2,()=>.8*$,"#777",.5,"center")),()=>{j.emit("transition-scene",1),j.off("tap",e)});j.on("tap",e),this.render=t=>{var i=H,l=$,n=Math.min(.03*l,.03*i);K(t,.03*-Date.now(),0,3,0),t.lineWidth=.2*n,t.strokeStyle="#555",t.beginPath(),t.moveTo(i/2-14*i/36,l/2),t.lineTo(i/2+14*i/36,l/2),t.stroke();for(let e=0;e<W.length+1;e++){var a=(e-7)*i/18+i/2;e<=o?(t.beginPath(),t.arc(a,.5*l,.6*n,0,6.29),t.fillStyle="#fff",t.fill()):(t.beginPath(),t.arc(a,.5*l,.5*n,0,6.29),t.fillStyle="#000",t.strokeStyle="#f55",t.fill(),t.stroke())}}}function oe(){p(new r("Planet Korva-6",()=>.03*H,()=>.05*H,"#fff",.5,"left")),p(new r("Package Delivered!",()=>H/2,()=>$/2,"#5f5",.6,"center")),p(new n("Main Menu")),j.on("start",()=>{j.emit("transition-scene",0)}),this.render=e=>{y(e),D(e,"#f55"),m(e,"Professor Quinn","Is that a Xenotransponder?? My brother Zorn must have sent this. Thank you, Courier!")}}function re(e){j.emit("txn"),j.on("txn-done",()=>{j.emit("scene",e),p(new l(.9,!1));for(let e=0;e<H;e+=.01*H)p(new J(e,$/2))}),c.forEach(e=>{e.update=void 0}),p(new l(.4,!0))}M=e=>{T=e,j.clear(),j.on("scene",M),j.on("transition-scene",re),a.stopMusic(),a.setup(),c=[],0==T&&p(new F),1==T&&(p(new Q),a.music()),2==T&&(p(new ie),a.bgRocket()),3==T&&(p(new ne),a.music()),4==T&&p(new ae),5==T&&p(new oe)},j.on("scene",M),isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),window.addEventListener("touchstart",e=>{e.stopPropagation(),j.emit("tap",{x:e.touches[0].clientX,y:e.touches[0].clientY})}),window.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),isMobile()||j.emit("tap",{x:e.x,y:e.y})}),window.addEventListener("mousemove",e=>{e.preventDefault(),e.stopPropagation(),isMobile()?j.emit("move",{x:-1,y:-1}):j.emit("move",{x:e.x,y:e.y})}),j.emit("scene",0),(P=document.createElement("canvas")).width=64,P.height=64,document.body.appendChild(P),(w=P.getContext("2d")).fillStyle="#000",w.fillRect(0,0,64,64),w.strokeStyle="#fa3",w.lineWidth=2,w.lineJoin="round",w.lineCap="round",w.strokeRect(0,0,64,64),w.translate(31,29),u[3].glyph(w,82,.05),document.querySelector("link[rel~='icon']").href=P.toDataURL(),document.body.removeChild(P),k=Date.now(),R=[],C=()=>{},(le=()=>{var e=Date.now(),t=.001*(e-k);.3<t&&(t=.3),i.fillStyle="#000",i.fillRect(0,0,H,$),R.length=0,c.forEach(e=>{(e.ecs||[]).forEach(e=>e(t)),(e.update||C)(t),(e.render||C)(i),e.destroyed&&R.push(e)}),R.forEach(e=>{var t;t=e,c=c.filter(e=>e!=t)}),k=e,requestAnimationFrame(le)})()})();</script></html>